2025-09-22 16:11:38 - root - INFO - [logging_config.py:51] - Logging configurado. Arquivo: C:\Users\Pedro Diniz\Documents\CadVision\CadVision_app\backend\logs\cadvision_20250922_161137.log
2025-09-22 16:11:38 - app - INFO - [logging_config.py:68] - EVENT: startup - DATA: {'timestamp': '2025-09-22T16:11:38.471162', 'service': 'app', 'event': 'startup', 'data': {'version': '1.1.0'}}
2025-09-22 16:11:38 - app.database - INFO - [database.py:175] - Banco de dados inicializado com sucesso (com novo schema).
2025-09-22 16:11:38 - app - INFO - [logging_config.py:68] - EVENT: database_initialized - DATA: {'timestamp': '2025-09-22T16:11:38.526162', 'service': 'app', 'event': 'database_initialized', 'data': {}}
2025-09-22 16:19:10 - vision/identify - INFO - [logging_config.py:68] - EVENT: process_started - DATA: {'timestamp': '2025-09-22T16:19:10.660931', 'service': 'vision/identify', 'event': 'process_started', 'data': {'vertical': 'supermercado', 'filename': 'arroz2.png', 'content_type': 'image/png'}}
2025-09-22 16:19:10 - vision/identify - INFO - [logging_config.py:68] - EVENT: image_loaded - DATA: {'timestamp': '2025-09-22T16:19:10.661932', 'service': 'vision/identify', 'event': 'image_loaded', 'data': {'size_bytes': 111706, 'hash': '44a30420041f34c214d9152407d5491a'}}
2025-09-22 16:19:10 - vision/identify - INFO - [logging_config.py:68] - EVENT: vision_extraction_start - DATA: {'timestamp': '2025-09-22T16:19:10.662931', 'service': 'vision/identify', 'event': 'vision_extraction_start', 'data': {}}
2025-09-22 16:19:10 - app.services.vision_service - INFO - [vision_service.py:108] - Imagem aprimorada para OCR.
2025-09-22 16:19:13 - app.services.vision_service - INFO - [vision_service.py:181] - Vision API: Texto extra√≠do (238 chars), Logos: 0, Labels: 8
2025-09-22 16:19:13 - app.services.vision_service - INFO - [vision_service.py:276] - Texto bruto: 'arroz
Tio Jo√£o
100% GRAOS Sempre soltinho
NOBRES
‚Ä¢Branquinho e saboroso
.N√£o precisa escolher
nem lavar
O arroz que
acompanha
ARROZ TIPO 1-CLASSE LONGO FINO
SUBGRUPO POLIDO - PESO L√çQUIDO 1kg
IND√öSTRIA BRASILEIRA
Tio Jo√£o 100% GROS
NOBRES' -> Texto limpo para an√°lise: '10011100'
2025-09-22 16:19:13 - app.services.vision_service - WARNING - [vision_service.py:297] - Nenhum GTIN v√°lido encontrado no texto limpo: '10011100'
2025-09-22 16:19:13 - vision/identify - INFO - [logging_config.py:68] - EVENT: vision_extraction_complete - DATA: {'timestamp': '2025-09-22T16:19:13.345092', 'service': 'vision/identify', 'event': 'vision_extraction_complete', 'data': {'success': True, 'text_length': 238, 'gtin_found': False}}
2025-09-22 16:19:13 - vision/identify - INFO - [logging_config.py:68] - EVENT: intelligent_analysis_start - DATA: {'timestamp': '2025-09-22T16:19:13.346094', 'service': 'vision/identify', 'event': 'intelligent_analysis_start', 'data': {'vertical': 'supermercado'}}
2025-09-22 16:19:13 - app.services.product_service - INFO - [product_service.py:70] - Etapa 1 falhou ou n√£o aplic√°vel. Iniciando Etapa 2 (Infer√™ncia da IA).
2025-09-22 16:19:16 - ai_service - INFO - [logging_config.py:68] - EVENT: json_parsed_successfully - DATA: {'timestamp': '2025-09-22T16:19:16.295039', 'service': 'ai_service', 'event': 'json_parsed_successfully', 'data': {'title_extracted': 'Arroz Tio Jo√£o Tipo 1 1kg', 'brand_extracted': 'Tio Jo√£o', 'category_extracted': 'Gr√£os e Cereais'}}
2025-09-22 16:19:16 - app.services.product_service - INFO - [product_service.py:84] - Produto identificado: Arroz Tio Jo√£o Tipo 1 1kg
2025-09-22 16:19:16 - app.services.product_service - INFO - [product_service.py:88] - Iniciando Etapa 3 (Enriquecimento com Busca na Web).
2025-09-22 16:19:16 - app.services.search_service - INFO - [search_service.py:30] - Buscando na web com a query: 'ean Tio Jo√£o Arroz Tio Jo√£o Tipo 1 1kg'
2025-09-22 16:19:17 - app.services.advanced_inference_service - INFO - [advanced_inference_service.py:93] - Extraindo GTIN do contexto de busca para 'Arroz Tio Jo√£o Tipo 1 1kg'
2025-09-22 16:19:18 - app.services.product_service - INFO - [product_service.py:101] - GTIN '7893500023425' extra√≠do da busca. Validando...
2025-09-22 16:19:20 - app.services.cosmos_service - INFO - [cosmos_service.py:72] - üì¶ Dados formatados do Cosmos: {'gtin': '7893500023425', 'title': 'ARROZ TIO JOAO 1KG', 'brand': '', 'category': '', 'ncm': '10063021', 'cest': '', 'confidence': 0.99, 'vertical': 'supermercado'}
2025-09-22 16:19:20 - app.services.product_service - INFO - [product_service.py:107] - Sucesso! Dados validados e enriquecidos pelo Cosmos via RAG.
2025-09-22 16:19:20 - vision/identify - INFO - [logging_config.py:68] - EVENT: intelligent_analysis_complete - DATA: {'timestamp': '2025-09-22T16:19:20.083829', 'service': 'vision/identify', 'event': 'intelligent_analysis_complete', 'data': {'title': 'ARROZ TIO JOAO 1KG', 'brand': ''}}
2025-09-22 16:19:20 - vision/identify - INFO - [logging_config.py:68] - EVENT: process_completed - DATA: {'timestamp': '2025-09-22T16:19:20.084813', 'service': 'vision/identify', 'event': 'process_completed', 'data': {'processing_time': 9.42, 'product_title': 'ARROZ TIO JOAO 1KG'}}
2025-09-22 16:19:39 - app.database - INFO - [database.py:196] - Tentativa de inserir produto com dados: {'sku': None, 'title': 'ARROZ TIO JOAO 1KG', 'vertical': 'supermercado', 'gtin': '7893500023425', 'brand': None, 'department': None, 'category': 'Outros', 'subcategory': None, 'price': None, 'ncm': '10063021', 'cest': None, 'confidence': 0.99, 'image_hash': '44a30420041f34c214d9152407d5491a'}
2025-09-22 16:19:40 - app.database - INFO - [database.py:234] - Produto ID 1 (Vertical: supermercado) salvo com sucesso.
2025-09-22 16:20:13 - vision/identify - INFO - [logging_config.py:68] - EVENT: process_started - DATA: {'timestamp': '2025-09-22T16:20:13.249491', 'service': 'vision/identify', 'event': 'process_started', 'data': {'vertical': 'vestuario', 'filename': 'Imagem do WhatsApp de 2025-09-21 √†(s) 16.46.16_17ae13c9.jpg', 'content_type': 'image/jpeg'}}
2025-09-22 16:20:13 - vision/identify - INFO - [logging_config.py:68] - EVENT: image_loaded - DATA: {'timestamp': '2025-09-22T16:20:13.250509', 'service': 'vision/identify', 'event': 'image_loaded', 'data': {'size_bytes': 102525, 'hash': 'b2fc004d6c9b4e068ae9234462176855'}}
2025-09-22 16:20:13 - vision/identify - INFO - [logging_config.py:68] - EVENT: vision_extraction_start - DATA: {'timestamp': '2025-09-22T16:20:13.251493', 'service': 'vision/identify', 'event': 'vision_extraction_start', 'data': {}}
2025-09-22 16:20:13 - app.services.vision_service - INFO - [vision_service.py:108] - Imagem aprimorada para OCR.
2025-09-22 16:20:15 - app.services.vision_service - INFO - [vision_service.py:181] - Vision API: Texto extra√≠do (156 chars), Logos: 0, Labels: 0
2025-09-22 16:20:15 - app.services.vision_service - INFO - [vision_service.py:276] - Texto bruto: '100% ALGOD√ÉO
DECOTE: 98% ALGOD√ÉO
2% ELASTANO
FORNECEDOR: 84891
Modelo: 1059827 - T. 20
40
P W
P
Êó•
Cor VERDE CLARO
000000113667090314
SKU: 11366709
PO:288843' -> Texto limpo para an√°lise: '100982848911059827204000000011366709031411366709288843'
2025-09-22 16:20:15 - app.services.vision_service - WARNING - [vision_service.py:297] - Nenhum GTIN v√°lido encontrado no texto limpo: '100982848911059827204000000011366709031411366709288843'
2025-09-22 16:20:15 - vision/identify - INFO - [logging_config.py:68] - EVENT: vision_extraction_complete - DATA: {'timestamp': '2025-09-22T16:20:15.487525', 'service': 'vision/identify', 'event': 'vision_extraction_complete', 'data': {'success': True, 'text_length': 156, 'gtin_found': False}}
2025-09-22 16:20:15 - vision/identify - INFO - [logging_config.py:68] - EVENT: intelligent_analysis_start - DATA: {'timestamp': '2025-09-22T16:20:15.488524', 'service': 'vision/identify', 'event': 'intelligent_analysis_start', 'data': {'vertical': 'vestuario'}}
2025-09-22 16:20:15 - app.services.product_service - INFO - [product_service.py:59] - Vertical 'vestuario' detectada. Iniciando diretamente com a Infer√™ncia da IA.
2025-09-22 16:20:17 - ai_service - INFO - [logging_config.py:68] - EVENT: json_parsed_successfully - DATA: {'timestamp': '2025-09-22T16:20:17.917565', 'service': 'ai_service', 'event': 'json_parsed_successfully', 'data': {'title_extracted': 'Blusa', 'brand_extracted': None, 'category_extracted': 'Blusas'}}
2025-09-22 16:20:17 - app.services.product_service - INFO - [product_service.py:84] - Produto identificado: Blusa
2025-09-22 16:20:17 - vision/identify - INFO - [logging_config.py:68] - EVENT: intelligent_analysis_complete - DATA: {'timestamp': '2025-09-22T16:20:17.918580', 'service': 'vision/identify', 'event': 'intelligent_analysis_complete', 'data': {'title': 'Blusa', 'brand': None}}
2025-09-22 16:20:17 - main - ERROR - [main.py:481] - Erro n√£o tratado na rota http://127.0.0.1:8000/api/v1/vision/identify: 1 validation error for IdentifiedProduct
gtin
  Value error, GTIN deve ter 8, 12, 13 ou 14 d√≠gitos [type=value_error, input_value='000000113667090314', input_type=str]
    For further information visit https://errors.pydantic.dev/2.11/v/value_error
Traceback (most recent call last):
  File "C:\Users\Pedro Diniz\Documents\CadVision\CadVision_app\backend\venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Pedro Diniz\Documents\CadVision\CadVision_app\backend\venv\Lib\site-packages\starlette\middleware\gzip.py", line 24, in __call__
    await responder(scope, receive, send)
  File "C:\Users\Pedro Diniz\Documents\CadVision\CadVision_app\backend\venv\Lib\site-packages\starlette\middleware\gzip.py", line 44, in __call__
    await self.app(scope, receive, self.send_with_gzip)
  File "C:\Users\Pedro Diniz\Documents\CadVision\CadVision_app\backend\venv\Lib\site-packages\starlette\middleware\cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Users\Pedro Diniz\Documents\CadVision\CadVision_app\backend\venv\Lib\site-packages\starlette\middleware\cors.py", line 148, in simple_response
    await self.app(scope, receive, send)
  File "C:\Users\Pedro Diniz\Documents\CadVision\CadVision_app\backend\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 65, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\Pedro Diniz\Documents\CadVision\CadVision_app\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 64, in wrapped_app
    raise exc
  File "C:\Users\Pedro Diniz\Documents\CadVision\CadVision_app\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Pedro Diniz\Documents\CadVision\CadVision_app\backend\venv\Lib\site-packages\starlette\routing.py", line 756, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\Pedro Diniz\Documents\CadVision\CadVision_app\backend\venv\Lib\site-packages\starlette\routing.py", line 776, in app
    await route.handle(scope, receive, send)
  File "C:\Users\Pedro Diniz\Documents\CadVision\CadVision_app\backend\venv\Lib\site-packages\starlette\routing.py", line 297, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Pedro Diniz\Documents\CadVision\CadVision_app\backend\venv\Lib\site-packages\starlette\routing.py", line 77, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\Pedro Diniz\Documents\CadVision\CadVision_app\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 64, in wrapped_app
    raise exc
  File "C:\Users\Pedro Diniz\Documents\CadVision\CadVision_app\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Pedro Diniz\Documents\CadVision\CadVision_app\backend\venv\Lib\site-packages\starlette\routing.py", line 72, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Pedro Diniz\Documents\CadVision\CadVision_app\backend\venv\Lib\site-packages\fastapi\routing.py", line 278, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Pedro Diniz\Documents\CadVision\CadVision_app\backend\venv\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Pedro Diniz\Documents\CadVision\CadVision_app\backend\main.py", line 163, in identify_image
    identified_product = models.IdentifiedProduct(**product_info)
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Pedro Diniz\Documents\CadVision\CadVision_app\backend\venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pydantic_core._pydantic_core.ValidationError: 1 validation error for IdentifiedProduct
gtin
  Value error, GTIN deve ter 8, 12, 13 ou 14 d√≠gitos [type=value_error, input_value='000000113667090314', input_type=str]
    For further information visit https://errors.pydantic.dev/2.11/v/value_error
2025-09-22 16:22:28 - app - INFO - [logging_config.py:68] - EVENT: shutdown - DATA: {'timestamp': '2025-09-22T16:22:28.682545', 'service': 'app', 'event': 'shutdown', 'data': {}}
2025-09-22 16:22:28 - main - INFO - [main.py:45] - Encerrando aplica√ß√£o CadVision API.
